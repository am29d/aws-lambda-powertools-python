
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>Logger - AWS Lambda Powertools Python</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#logger" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="AWS Lambda Powertools Python" class="md-header-nav__button md-logo" aria-label="AWS Lambda Powertools Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            AWS Lambda Powertools Python
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Logger
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AWS Lambda Powertools Python" class="md-nav__button md-logo" aria-label="AWS Lambda Powertools Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AWS Lambda Powertools Python
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Homepage
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Core utilities
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Core utilities" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Core utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tracer/" class="md-nav__link">
        Tracer
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Logger
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Logger
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-utility" class="md-nav__link">
    Core utility
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-structured-keys" class="md-nav__link">
    Standard structured keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capturing-lambda-context-info" class="md-nav__link">
    Capturing Lambda context info
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appending-additional-keys" class="md-nav__link">
    Appending additional keys
  </a>
  
    <nav class="md-nav" aria-label="Appending additional keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure_logs" class="md-nav__link">
    structure_logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-parameter" class="md-nav__link">
    extra parameter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-logger-across-your-code" class="md-nav__link">
    Reusing Logger across your code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-debug-logs" class="md-nav__link">
    Sampling debug logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-from-other-loggers" class="md-nav__link">
    Migrating from other Loggers
  </a>
  
    <nav class="md-nav" aria-label="Migrating from other Loggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-parameter" class="md-nav__link">
    service parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inheriting-loggers" class="md-nav__link">
    inheriting Loggers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-log-records" class="md-nav__link">
    overriding Log records
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-exceptions" class="md-nav__link">
    logging exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-code" class="md-nav__link">
    Testing your code
  </a>
  
    <nav class="md-nav" aria-label="Testing your code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytest-live-log-feature" class="md-nav__link">
    pytest live log feature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Utilities
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Utilities" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/middleware_factory/" class="md-nav__link">
        Middleware factory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/parameters/" class="md-nav__link">
        Parameters
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/batch/" class="md-nav__link">
        SQS Batch Processing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/typing/" class="md-nav__link">
        Typing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/data_classes/" class="md-nav__link">
        Event Source Data Classes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/parser/" class="md-nav__link">
        Parser
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-utility" class="md-nav__link">
    Core utility
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-structured-keys" class="md-nav__link">
    Standard structured keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capturing-lambda-context-info" class="md-nav__link">
    Capturing Lambda context info
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appending-additional-keys" class="md-nav__link">
    Appending additional keys
  </a>
  
    <nav class="md-nav" aria-label="Appending additional keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure_logs" class="md-nav__link">
    structure_logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-parameter" class="md-nav__link">
    extra parameter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-logger-across-your-code" class="md-nav__link">
    Reusing Logger across your code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-debug-logs" class="md-nav__link">
    Sampling debug logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-from-other-loggers" class="md-nav__link">
    Migrating from other Loggers
  </a>
  
    <nav class="md-nav" aria-label="Migrating from other Loggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-parameter" class="md-nav__link">
    service parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inheriting-loggers" class="md-nav__link">
    inheriting Loggers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-log-records" class="md-nav__link">
    overriding Log records
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-exceptions" class="md-nav__link">
    logging exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-code" class="md-nav__link">
    Testing your code
  </a>
  
    <nav class="md-nav" aria-label="Testing your code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytest-live-log-feature" class="md-nav__link">
    pytest live log feature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="logger">Logger</h1>
<h2 id="core-utility">Core utility</h2>
<p>Logger provides an opinionated logger with output structured as JSON.</p>
<p><strong>Key features</strong></p>
<ul>
<li>Capture key fields from Lambda context, cold start and structures logging output as JSON</li>
<li>Log Lambda event when instructed (disabled by default)<ul>
<li>Enable via <code>POWERTOOLS_LOGGER_LOG_EVENT="true"</code> or explicitly via decorator param</li>
</ul>
</li>
<li>Log sampling enables DEBUG log level for a percentage of requests (disabled by default)<ul>
<li>Enable via <code>POWERTOOLS_LOGGER_SAMPLE_RATE=0.1</code>, ranges from 0 to 1, where 0.1 is 10% and 1 is 100%</li>
</ul>
</li>
<li>Append additional keys to structured log at any point in time</li>
</ul>
<h2 id="initialization">Initialization</h2>
<p>Set <code>LOG_LEVEL</code> env var as a start - Here is an example using AWS Serverless Application Model (SAM)</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">template.yaml</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">Resources</span><span class="p">:</span>
    <span class="nt">HelloWorldFunction</span><span class="p">:</span>
        <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
        <span class="nt">Properties</span><span class="p">:</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
        <span class="nt">Runtime</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3.8</span>
        <span class="nt">Environment</span><span class="p">:</span>
            <span class="nt">Variables</span><span class="p">:</span>
<span class="hll">                <span class="nt">LOG_LEVEL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">INFO</span>
</span></code></pre></div>
</td></tr></table>
<p>By default, Logger uses <strong>INFO</strong> log level. You can either change log level via <code>level</code> param or via env var.</p>
<p>You can also explicitly set a service name via <code>service</code> param or via <code>POWERTOOLS_SERVICE_NAME</code> env var. This sets <strong>service</strong> key that will be present across all log statements.</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">app.py</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="c1"># POWERTOOLS_SERVICE_NAME defined</span>
<span class="hll"><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
</span>
<span class="c1"># Explicit definition</span>
<span class="n">Logger</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&quot;payment&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<h2 id="standard-structured-keys">Standard structured keys</h2>
<p>Your Logger will include the following keys to your structured logging, by default:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>timestamp</strong></td>
<td>str</td>
<td>"2020-05-24 18:17:33,774"</td>
<td>Timestamp of actual log statement</td>
</tr>
<tr>
<td><strong>level</strong></td>
<td>str</td>
<td>"INFO"</td>
<td>Logging level</td>
</tr>
<tr>
<td><strong>location</strong></td>
<td>str</td>
<td>"collect.handler:1"</td>
<td>Source code location where statement was executed</td>
</tr>
<tr>
<td><strong>service</strong></td>
<td>str</td>
<td>"payment"</td>
<td>Service name defined. "service_undefined" will be used if unknown</td>
</tr>
<tr>
<td><strong>sampling_rate</strong></td>
<td>int</td>
<td>0.1</td>
<td>Debug logging sampling rate in percentage e.g. 10% in this case</td>
</tr>
<tr>
<td><strong>message</strong></td>
<td>any</td>
<td>"Collecting payment"</td>
<td>Log statement value. Unserializable JSON values will be casted to string</td>
</tr>
<tr>
<td><strong>xray_trace_id</strong></td>
<td>str</td>
<td>"1-5759e988-bd862e3fe1be46a994272793"</td>
<td>X-Ray Trace ID when Lambda function has enabled Tracing</td>
</tr>
</tbody>
</table>
<h2 id="capturing-lambda-context-info">Capturing Lambda context info</h2>
<p>You can enrich your structured logs with key Lambda context information via <code>inject_lambda_context</code>.</p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">collect.py</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="nd">@logger</span><span class="o">.</span><span class="n">inject_lambda_context</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting payment&quot;</span><span class="p">)</span>
   <span class="o">...</span>
   <span class="c1"># You can log entire objects too</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">({</span>
      <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;collect_payment&quot;</span><span class="p">,</span>
      <span class="s2">&quot;charge_id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;charge_id&#39;</span><span class="p">]</span>
   <span class="p">})</span>
   <span class="o">...</span>
</code></pre></div>
</td></tr></table>
<p>When used, this will include the following keys:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>cold_start</strong></td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td><strong>function_name</strong></td>
<td>str</td>
<td>"example-powertools-HelloWorldFunction-1P1Z6B39FLU73"</td>
</tr>
<tr>
<td><strong>function_memory_size</strong></td>
<td>int</td>
<td>128</td>
</tr>
<tr>
<td><strong>function_arn</strong></td>
<td>str</td>
<td>"arn:aws:lambda:eu-west-1:012345678910:function:example-powertools-HelloWorldFunction-1P1Z6B39FLU73"</td>
</tr>
<tr>
<td><strong>function_request_id</strong></td>
<td>str</td>
<td>"899856cb-83d1-40d7-8611-9e78f15f32f4"</td>
</tr>
</tbody>
</table>
<details class="example"><summary>Excerpt output in CloudWatch Logs</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;2020-05-24 18:17:33,774&quot;</span><span class="p">,</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;collect.handler:1&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="s2">&quot;payment&quot;</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;lambda_function_name&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
</span><span class="hll">   <span class="nt">&quot;lambda_function_memory_size&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
</span><span class="hll">   <span class="nt">&quot;lambda_function_arn&quot;</span><span class="p">:</span><span class="s2">&quot;arn:aws:lambda:eu-west-1:12345678910:function:test&quot;</span><span class="p">,</span>
</span><span class="hll">   <span class="nt">&quot;lambda_request_id&quot;</span><span class="p">:</span><span class="s2">&quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;</span><span class="p">,</span>
</span><span class="hll">   <span class="nt">&quot;cold_start&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span>   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Collecting payment&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;2020-05-24 18:17:33,774&quot;</span><span class="p">,</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;collect.handler:15&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="s2">&quot;payment&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_name&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_memory_size&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_arn&quot;</span><span class="p">:</span><span class="s2">&quot;arn:aws:lambda:eu-west-1:12345678910:function:test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_request_id&quot;</span><span class="p">:</span><span class="s2">&quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;</span><span class="p">,</span>
   <span class="nt">&quot;cold_start&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;message&quot;</span><span class="p">:{</span>
</span><span class="hll">      <span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;collect_payment&quot;</span><span class="p">,</span>
</span><span class="hll">      <span class="nt">&quot;charge_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ch_AZFlk2345C0&quot;</span>
</span>   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<p>You can also explicitly log any incoming event using <code>log_event</code> param or via <code>POWERTOOLS_LOGGER_LOG_EVENT</code> env var.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>This is disabled by default to prevent sensitive info being logged.</p>
<div class="tabbed-set" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">log_handler_event.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="hll"><span class="nd">@logger</span><span class="o">.</span><span class="n">inject_lambda_context</span><span class="p">(</span><span class="n">log_event</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
   <span class="o">...</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<h2 id="appending-additional-keys">Appending additional keys</h2>
<p>You can append additional keys using either mechanism:</p>
<ul>
<li>Persist new keys across all future log messages via <code>structure_logs</code></li>
<li>Add additional keys on a per log message basis via <code>extra</code> parameter</li>
</ul>
<h3 id="structure_logs">structure_logs</h3>
<p>You can append your own keys to your existing Logger via <code>structure_logs</code> with <strong>append</strong> param.</p>
<div class="tabbed-set" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">collect.py</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
   <span class="n">order_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order_id&quot;</span><span class="p">)</span>
<span class="hll">   <span class="n">logger</span><span class="o">.</span><span class="n">structure_logs</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span> <span class="c1"># highlight-line</span>
</span>   <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting payment&quot;</span><span class="p">)</span>
      <span class="o">...</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>Note: Logger will automatically reject any key with a None value.</p>
</blockquote>
<p>If you conditionally add keys depending on the payload, you can use the highlighted line above as an example.</p>
<p>This example will add <code>order_id</code> if its value is not empty, and in subsequent invocations where <code>order_id</code> might not be present it'll remove it from the logger.</p>
<details class="example"><summary>Excerpt output in CloudWatch Logs</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-05-24 18:17:33,774&quot;</span><span class="p">,</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;collect.handler:1&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;order_id&quot;</span><span class="p">:</span> <span class="s2">&quot;order_id_value&quot;</span><span class="p">,</span> <span class="err">//</span> <span class="err">highligh</span><span class="kc">t</span><span class="mi">-</span><span class="err">li</span><span class="kc">ne</span>
</span>   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Collecting payment&quot;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="extra-parameter">extra parameter</h3>
<p>Extra parameter is available for all log levels, as implemented in the standard logging library. It accepts any dictionary, and it'll be added as part of the root structure of the logs.</p>
<div class="tabbed-set" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><label for="__tabbed_6_1">extra_parameter.py</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&quot;payment&quot;</span><span class="p">)</span>

<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1123&quot;</span> <span class="p">}</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>Excerpt output in CloudWatch Logs</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-01-12 14:08:12,357&quot;</span><span class="p">,</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;collect.handler:1&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1123&quot;</span><span class="p">,</span>
</span>   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Collecting payment&quot;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<h2 id="reusing-logger-across-your-code">Reusing Logger across your code</h2>
<p>Logger supports inheritance via <code>child</code> parameter. This allows you to create multiple Loggers across your code base, and propagate changes such as new keys to all Loggers.</p>
<div class="tabbed-set" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><label for="__tabbed_7_1">collect.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># POWERTOOLS_SERVICE_NAME: &quot;payment&quot;</span>
<span class="kn">import</span> <span class="nn">shared</span> <span class="c1"># Creates a child logger named &quot;payment.shared&quot;</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="hll">  <span class="n">shared</span><span class="o">.</span><span class="n">inject_payment_id</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span class="hll">  <span class="n">logger</span><span class="o">.</span><span class="n">structure_logs</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order_id</span><span class="o">=</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;order_id&quot;</span><span class="p">])</span>
</span>      <span class="o">...</span>
</code></pre></div>
</td></tr></table>
</div>
<input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><label for="__tabbed_7_2">shared.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># POWERTOOLS_SERVICE_NAME: &quot;payment&quot;</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="hll"><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
<span class="k">def</span> <span class="nf">inject_payment_id</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">structure_logs</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">payment_id</span><span class="o">=</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;payment_id&quot;</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>In this example, <code>Logger</code> will create a parent logger named <code>payment</code> and a child logger named <code>payment.shared</code>. Any changes in the parent and child <code>Loggers</code> will be propagated among them.</p>
<p>If you ever forget to use <code>child</code> param, we will return an existing <code>Logger</code> with the same <code>service</code> name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Child loggers will be named after the following convention <code>service.filename</code>.</p>
</div>
<h2 id="sampling-debug-logs">Sampling debug logs</h2>
<p>Sampling allows you to set your Logger Log Level as DEBUG based on a percentage of your concurrent/cold start invocations. You can set a sampling value of <code>0.0</code> to <code>1</code> (100%) using either <code>sample_rate</code> parameter or <code>POWERTOOLS_LOGGER_SAMPLE_RATE</code> env var.</p>
<p>This is useful when you want to troubleshoot an issue, say a sudden increase in concurrency, and you might not have enough information in your logs as Logger log level was understandably set as INFO.</p>
<p>Sampling decision happens at the Logger class initialization, which only happens during a cold start. This means sampling may happen significantly more or less than you expect if you have a steady low number of invocations and thus few cold starts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want Logger to calculate sampling on every invocation, then please open a feature request.</p>
</div>
<div class="tabbed-set" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><label for="__tabbed_8_1">collect.py</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="c1"># Sample 10% of debug logs e.g. 0.1</span>
<span class="hll"><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">sample_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Verifying whether order_id is present&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="s2">&quot;order_id&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting payment&quot;</span><span class="p">)</span>
      <span class="o">...</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>Excerpt output in CloudWatch Logs</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-05-24 18:17:33,774&quot;</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
</span>   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;collect.handler:1&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_memory_size&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:eu-west-1:12345678910:function:test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;</span><span class="p">,</span>
   <span class="nt">&quot;cold_start&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span>   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Verifying whether order_id is present&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-05-24 18:17:33,774&quot;</span><span class="p">,</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;collect.handler:1&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_memory_size&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
   <span class="nt">&quot;lambda_function_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:eu-west-1:12345678910:function:test&quot;</span><span class="p">,</span>
   <span class="nt">&quot;lambda_request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;</span><span class="p">,</span>
   <span class="nt">&quot;cold_start&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="hll">   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span>   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Collecting payment&quot;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<h2 id="migrating-from-other-loggers">Migrating from other Loggers</h2>
<p>If you're migrating from other Loggers, there are few key points to be aware of: <strong>Service parameter</strong>, <strong>Inheriting Loggers</strong>, <strong>Overriding Log records</strong>, and <strong>Logging exceptions</strong>.</p>
<h3 id="service-parameter">service parameter</h3>
<p>Service is what defines what the function is responsible for, or part of (e.g payment service), and the name of the Logger.</p>
<p>For Logger, the <code>service</code> is the logging key customers can use to search log operations for one or more functions - For example, <strong>search for all errors, or messages like X, where service is payment</strong>.</p>
<h3 id="inheriting-loggers">inheriting Loggers</h3>
<blockquote>
<p>Python Logging hierarchy happens via the dot notation: <code>service</code>, <code>service.child</code>, <code>service.child_2</code>.</p>
</blockquote>
<p>For inheritance, Logger uses a <code>child=True</code> parameter along with <code>service</code> being the same value across Loggers.</p>
<p>For child Loggers, we introspect the name of your module where <code>Logger(child=True, service="name")</code> is called, and we name your Logger as <strong>{service}.{filename}</strong>.</p>
<p>A common issue when migrating from other Loggers is that <code>service</code> might be defined in the parent Logger (no child param), and not defined in the child Logger:</p>
<div class="tabbed-set" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><label for="__tabbed_9_1">incorrect_logger_inheritance.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">my_module</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="hll"><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&quot;payment&quot;</span><span class="p">)</span>
</span><span class="o">...</span>

<span class="c1"># my_module.py</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="hll"><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
</td></tr></table>
</div>
</div>
<p>In this case, Logger will register a Logger named <code>payment</code>, and a Logger named <code>service_undefined</code>. The latter isn't inheriting from the parent, and will have no handler, thus no message being logged to standard output.</p>
<p>This can be fixed by either ensuring both has the <code>service</code> value as <code>payment</code>, or simply use the environment variable <code>POWERTOOLS_SERVICE_NAME</code> to ensure service value will be the same across all Loggers when not explicitly set.</p>
<h3 id="overriding-log-records">overriding Log records</h3>
<p>You might want to continue to use the same date formatting style, or override <code>location</code> to display the <code>package.function_name:line_number</code> as you previously had.</p>
<p>Logger allows you to either change the format or suppress the following keys altogether at the initialization: <code>location</code>, <code>timestamp</code>, <code>level</code>, <code>xray_trace_id</code>, and <code>datefmt</code></p>
<div class="tabbed-set" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><label for="__tabbed_10_1">lambda_handler.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="c1"># override default values for location and timestamp format</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(funcName)s</span><span class="s2">] </span><span class="si">%(module)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;fake-datefmt&quot;</span><span class="p">)</span> <span class="c1"># highlight-line</span>

<span class="c1"># suppress location key</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># highlight-line</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Alternatively, you can also change the order of the following log record keys via the <code>log_record_order</code> parameter: <code>level</code>, <code>location</code>, <code>message</code>, <code>xray_trace_id</code>, and <code>timestamp</code></p>
<div class="tabbed-set" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><label for="__tabbed_11_1">lambda_handler.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="c1"># make message as the first key</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">log_record_order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span> <span class="c1"># highlight-line</span>

<span class="c1"># Default key sorting order</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">log_record_order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span> <span class="c1"># highlight-line</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Some keys cannot be supressed in the Log records: <code>sampling_rate</code> is part of the specification and cannot be supressed; <code>xray_trace_id</code> is supressed automatically if X-Ray is not enabled in the Lambda function, and added automatically if it is.</p>
<h3 id="logging-exceptions">logging exceptions</h3>
<p>When logging exceptions, Logger will add a new key named <code>exception</code>, and will serialize the full traceback as a string.</p>
<div class="tabbed-set" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><label for="__tabbed_12_1">logging_an_exception.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;something went wrong&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
     <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Received an exception&quot;</span><span class="p">)</span> <span class="c1"># highlight-line</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<details class="example"><summary>Excerpt output in CloudWatch Logs</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;module&gt;:4&quot;</span><span class="p">,</span>
   <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Received an exception&quot;</span><span class="p">,</span>
   <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-08-28 18:11:38,886&quot;</span><span class="p">,</span>
   <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;service_undefined&quot;</span><span class="p">,</span>
   <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
   <span class="nt">&quot;exception&quot;</span><span class="p">:</span> <span class="s2">&quot;Traceback (most recent call last):\n  File \&quot;&lt;input&gt;\&quot;, line 2, in &lt;module&gt;\nValueError: something went wrong&quot;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<h2 id="testing-your-code">Testing your code</h2>
<p>When unit testing your code that makes use of <code>inject_lambda_context</code> decorator, you need to pass a dummy Lambda Context, or else Logger will fail.</p>
<p>This is a Pytest sample that provides the minimum information necessary for Logger to succeed:</p>
<div class="tabbed-set" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><label for="__tabbed_13_1">fake_lambda_context_for_logger.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">lambda_context</span><span class="p">():</span>
    <span class="n">lambda_context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="s2">&quot;memory_limit_in_mb&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
        <span class="s2">&quot;invoked_function_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:eu-west-1:809313241:function:test&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aws_request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;LambdaContext&quot;</span><span class="p">,</span> <span class="n">lambda_context</span><span class="o">.</span><span class="n">keys</span><span class="p">())(</span><span class="o">*</span><span class="n">lambda_context</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">test_lambda_handler</span><span class="p">(</span><span class="n">lambda_handler</span><span class="p">,</span> <span class="n">lambda_context</span><span class="p">):</span>
    <span class="n">test_event</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;event&#39;</span><span class="p">}</span>
    <span class="n">lambda_handler</span><span class="p">(</span><span class="n">test_event</span><span class="p">,</span> <span class="n">lambda_context</span><span class="p">)</span> <span class="c1"># this will now have a Context object populated</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<h3 id="pytest-live-log-feature">pytest live log feature</h3>
<p>Pytest Live Log feature duplicates emitted log messages in order to style log statements according to their levels, for this to work use <code>POWERTOOLS_LOG_DEDUPLICATION_DISABLED</code> env var.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">POWERTOOLS_LOG_DEDUPLICATION_DISABLED</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> pytest -o <span class="nv">log_cli</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
</td></tr></table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature should be used with care, as it explicitly disables our ability to filter propagated messages to the root logger (if configured).</p>
</div>
<h2 id="faq">FAQ</h2>
<p><strong>How can I enable boto3 and botocore library logging?</strong></p>
<p>You can enable the <code>botocore</code> and <code>boto3</code> logs by using the <code>set_stream_logger</code> method, this method will add a stream handler
for the given name and level to the logging module. By default, this logs all boto3 messages to stdout.</p>
<div class="tabbed-set" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><label for="__tabbed_14_1">log_botocore_and_boto3.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools.utilities.typing</span> <span class="kn">import</span> <span class="n">LambdaContext</span>
<span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="hll"><span class="n">boto3</span><span class="o">.</span><span class="n">set_stream_logger</span><span class="p">()</span>
</span><span class="hll"><span class="n">boto3</span><span class="o">.</span><span class="n">set_stream_logger</span><span class="p">(</span><span class="s1">&#39;botocore&#39;</span><span class="p">)</span>
</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">LambdaContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Buckets&quot;</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p><strong>What's the difference between <code>structure_log</code> and <code>extra</code>?</strong></p>
<p>Keys added with <code>structure_log</code> will persist across multiple log messages while keys added via <code>extra</code> will only be available in a given log message operation.</p>
<p><strong>Example - Persisting payment_id not request_id</strong></p>
<div class="tabbed-set" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><label for="__tabbed_15_1">lambda_handler.py</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aws_lambda_powertools</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&quot;payment&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">structure_logs</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">payment_id</span><span class="o">=</span><span class="s2">&quot;123456789&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">booking_id</span> <span class="o">=</span> <span class="n">book_flight</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flight booked successfully&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;booking_id&quot;</span><span class="p">:</span> <span class="n">booking_id</span><span class="p">})</span>
<span class="k">except</span> <span class="n">BookingReservationError</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;goodbye&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Note that <code>payment_id</code> remains in both log messages while <code>booking_id</code> is only available in the first message.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;module&gt;:5&quot;</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Flight booked successfully&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-01-12 14:09:10,859&quot;</span><span class="p">,</span>
    <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="nt">&quot;payment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123456789&quot;</span><span class="p">,</span>
    <span class="nt">&quot;booking_id&quot;</span><span class="p">:</span> <span class="s2">&quot;75edbad0-0857-4fc9-b547-6180e2f7959b&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;module&gt;:6&quot;</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;goodbye&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-01-12 14:09:10,860&quot;</span><span class="p">,</span>
    <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sampling_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="nt">&quot;payment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123456789&quot;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../tracer/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tracer
              </div>
            </div>
          </a>
        
        
          <a href="../metrics/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Metrics
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.sections'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
    
  </body>
</html>